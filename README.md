Z3-Python scripts to solve N-queens type puzzles on a Stratego board
====================================================================

[![Language](https://img.shields.io/badge/language-Python-blue.svg)](https://www.python.org/)
[![Standard](https://img.shields.io/badge/Python-3.6-blue.svg)](https://en.wikipedia.org/wiki/History_of_Python)
[![License](https://img.shields.io/badge/license-Boost-blue.svg)](https://opensource.org/licenses/BSL-1.0)
[![](https://tokei.rs/b1/github/rhalbersma/zed)](https://github.com/rhalbersma/zed)

[Who's Zed](https://www.imdb.com/title/tt0110912/characters/nm0000246)
----------------------------------------------------------------------
> **Fabienne** : Whose motorcycle is this?  
> **Butch** : It's a chopper, baby.  
> **Fabienne** : Whose chopper is this?  
> **Butch** : It's Zed's.  
> **Fabienne** : Who's Zed?  
> **Butch** : Zed's dead, baby. Zed's dead.

Six Easy Pieces
---------------

This repository was inspired by a series of six puzzles initiated on the [Stratego.com](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/) web forum. Below a brief description and solutions to all six puzzles, presented in increasing level of sophistication (which is not entirely the chronological order).  
The solution diagrams use `.` to denote an empty square, `#` as an inaccessible and impassable lake, `B` as a bomb, and `2` as a scout (which is 2nd in the ranking of the various pieces).

Installation
------------

All solutions were generated by Microsoft's open scource [Z3-solver](https://github.com/Z3Prover/z3), using its Python bindings (and [NumPy](http://www.numpy.org/) for array manipulations). You can easily reproduce the analyses on a machine with Python 3 by the following configuration:

    python3 -m pip install virtualenv
    python3 -m virtualenv .env
    source .env/bin/activate
    pip install -r requirements.txt

and you are good to go to run the various scripts in this repo's `src` folder. All the dependencies are handled for you through the virtual environment. Once you are done with the analysis, you can run

    deactivate

to get back your regular development environment.

I The minimum number of bombs on a Stratego setup area such that each 2x3 and 3x2 rectangle contains at least one bomb
----------------------------------------------------------------------------------------------------------------------

This [puzzle](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=11667) was first posted (without answer) in February 2014 by forum member [maxroelofs](http://forum.stratego.com/user/489-maxroelofs/).  
In November 2017, I [posted the answer](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=441746) (at the time, using a brute force C++ program to confirm my hand-made solution).  
The minimum number of bombs satisfying the constraints == 6.  
Z3 finds the solution by direct minimization within 1 second.  

    . . . . . . . . . .
    . B . . B . . B . .
    . . B . . B . . B .
    . . . . . . . . . .

II The minimum number of bombs on a Stratego setup area such that each 2x3, 3x2 and 1x6 rectangle contains at least one bomb
----------------------------------------------------------------------------------------------------------------------------

This [puzzle](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=11661) and its [answer](http://forum.stratego.com/topic/1146-stratego-quizz-and-training-forum-answers/?p=11813) were first posted in February 2014 by forum member [Napoleon 1er](http://forum.stratego.com/user/791-napoleon-1er/).  
The link to the original answer no longer shows the solution diagram.  
In November 2017, I [posted the answer](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=441745) (at the time, using a brute force C++ program to confirm my hand-made solution).  
The minimum number of bombs satisfying the constraints == 7.  
Z3 finds the solution by direct minimization within 1 second.  

    . . . . . B . . . .
    . B . . B . . B . .
    . . B . . . . . B .
    . . . . . B . . . .

III The minimum number of scouts on a Stratego board such that each square is occupied or threatened by a scout   
---------------------------------------------------------------------------------------------------------------

In graph theory, this number is called [**the domination number**](https://en.wikipedia.org/wiki/Dominating_set).  
In November 2017, I posted [this puzzle and its answer](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=441845) (at the time, an unverified hand-made solution).  
The minimum number of scouts satisfying the constraints == 8.  
Z3 finds the solution by direct minimization within 1 second.  

    . 2 . . . . . . . .
    . . . . . 2 . . . .
    . 2 . . . . . . . .
    2 . . . . . . . . .
    . . # # . . # # . .
    . . # # . . # # . .
    . . . . . . . . . 2
    . . . . . . . . 2 .
    . 2 . . . . . . . .
    . . . . 2 . . . . .

IV The maximum number of scouts on a Stratego board such that no scout threatens another scout
----------------------------------------------------------------------------------------------

In graph theory, this number is called the [**the independence number**](https://en.wikipedia.org/wiki/Independent_set_(graph_theory)).  
This [puzzle](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=11659) and its [answer](http://forum.stratego.com/topic/1146-stratego-quizz-and-training-forum-answers/?p=11812) were first posted in February 2014 by forum user [Napoleon 1er](http://forum.stratego.com/user/791-napoleon-1er/).  
The link to the original answer no longer shows the solution diagram.  
In November 2017, I [posted the answer](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=441750) (at the time, an unverified hand-made solution).  
The maximum number of scouts satisfying the constraints == 14.  
Z3 finds the solution by direct minimization within 1 second.  

    . . . . . . 2 . . .
    . . . 2 . . . . . .
    . . . . . . . 2 . .
    . . 2 . . . . . . .
    2 . # # 2 . # # . 2
    . 2 # # . 2 # # 2 .
    . . . 2 . . . . . .
    . . . . . . . 2 . .
    . . 2 . . . . . . .
    . . . . . . 2 . . .

V The maximum number of scouts on a Stratego board such that each scout threatens exactly one other scout
---------------------------------------------------------------------------------------------------------

This [puzzle](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=11670) was first posted (without answer) in February 2014 by forum member [maxroelofs](http://forum.stratego.com/user/489-maxroelofs/).  
In July 2018, I [posted the answer](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=457225) (using the Z3-solver).  
The maximum number of scouts satisfying the constraints == 18.  
Z3 proofs N == 18 within 1 second, and disproofs N == 20 within a minute.  
Direct minimization seems out of reach since Z3 does not recognize that N has to be even.  

    2 . . . . . . . . .
    . . . . . . . . . 2
    . . . 2 . . . 2 . .
    . . 2 . . . 2 . . .
    . 2 # # . . # # . 2
    2 . # # 2 2 # # 2 .
    . . . . . . . . 2 .
    . 2 . . . . . . . .
    . . . . . . 2 2 . .
    . . 2 2 . . . . . .

VI The maximum number of scouts on a Stratego board with at most 6 bombs in each setup area such that no scout threatens another scout   
--------------------------------------------------------------------------------------------------------------------------------------

This [puzzle](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=11671) was first posted (without answer) in February 2014 by forum member [The Prof](http://forum.stratego.com/user/572-the-prof/).  
In July 2018, I posted [the answer](http://forum.stratego.com/topic/1134-stratego-quizz-and-training-forum/?p=458177) obtained from private communication with computer scientist [Wieger Wesselink](http://www.win.tue.nl/~wieger/).  
This solution had been found by Wesselink in collaboration with his colleague [Hans Zantema](https://www.win.tue.nl/~hzantema/) (using the Z3-solver).  
The maximum number of scouts satisfying the constraints == 24.  
My current Z3 script proofs N == 24 within 15 minutes, and finds no disproof for N == 25 within an hour.  
The Wesselink-Zantema approach manages to proof/disproof N == 24/25 within 10 seconds each.

    . . . 2 B 2 . . . . 
    . . 2 B 2 B 2 . . . 
    . . . 2 B 2 B 2 . . 
    . . . . 2 B 2 . . . 
    2 . # # . . # # 2 . 
    . . # # . 2 # # . 2 
    . . . 2 . B 2 . . . 
    . . 2 B . 2 B 2 . . 
    . 2 B 2 B . 2 . . . 
    . . 2 B 2 . . . . .

Contributing
------------

The Z3-solver is easy to use, but also easy to misuse.  In particular, it's hard to predict its performance.  
A constraint rewrite, or even a reordering can induce a 10X speedup, or a 10X speed penalty.  
The following open challenges are identified (pull requests welcome!):
- [ ] Make problem 5 amenable to direct minimization
- [ ] Push problem 6 to within the same ballpark as the Wesselink-Zantema approach

Apart from accepting answers to these challenges, this repo is in maintenance mode and no longer actively being developed.

Acknowledgments
---------------

Thanks to [Wieger Wesselink](http://www.win.tue.nl/~wieger/) for introducing me to the world of SMT solvers, for stimulating discussion, and for staying 100X ahead of me on the sixth and hardest puzzle.

License
-------

Copyright Rein Halbersma 2018.  
Distributed under the [Boost Software License, Version 1.0](http://www.boost.org/users/license.html).  
(See accompanying file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
